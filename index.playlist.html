<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>subbasses.com - Playlists</title>
  <link rel="stylesheet" href="styles/playlist.css">
  <link rel="icon" type="image/x-icon" href="images/speaker-high-volume_padded_4000x4000-removebg-preview.png">

  <!-- font for play/pause button -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <header>
    <img src="images/cooltext494848403796185.png" alt="SUBBASSES Logo" class="header-logo">
    
    <!-- User Account & Cart Section -->
    <div class="header-controls">
      <button id="cartBtn" class="header-btn">
        <i class="fa fa-shopping-cart"></i>
        <span id="cartCount" class="cart-count">0</span>
      </button>
      <button id="loginBtn" class="header-btn">
        <i class="fa fa-user"></i>
        <span id="userStatus">Login</span>
      </button>
    </div>
  </header>

  <!--Swag Section -->
  <section id="swag">
    <p>immerse yourself into the subbass</p>
    <img src="images/speaker-high-volume_padded_4000x4000-removebg-preview.png" alt="subbasses" width="400">
  </section>

  <!-- Beats Playlist Section -->
  <section id="beats" class="playlist-section">
    <h2>Beats</h2>
    
    <!-- Track Name -->
    <div id="trackName-beats">No track loaded</div>

    <!-- Waveform container -->
    <div id="waveform-beats"></div>

    <div class="controls">
      <!-- Previous Track -->
      <button id="prevBtn-beats" class="wave-btn">
        <i class="fa fa-backward"></i>
      </button>

      <!-- Play/Pause button -->
      <button id="playBtn-beats" class="wave-btn">
        <i class="fa fa-play"></i>
      </button>

      <!-- Next Track -->
      <button id="nextBtn-beats" class="wave-btn">
        <i class="fa fa-forward"></i>
      </button>

      <!-- Download button -->
      <a id="downloadBtn-beats" class="wave-btn" href="#" download>
        <i class="fa fa-download"></i>
      </a>
    </div>

    <!-- Track List -->
    <ul class="track-list" id="trackList-beats"></ul>
  </section>

  <!-- Melodies Playlist Section -->
  <section id="melodies" class="playlist-section">
    <h2>Melodies</h2>
    
    <!-- Track Name -->
    <div id="trackName-melodies">No track loaded</div>

    <!-- Waveform container -->
    <div id="waveform-melodies"></div>

    <div class="controls">
      <!-- Previous Track -->
      <button id="prevBtn-melodies" class="wave-btn">
        <i class="fa fa-backward"></i>
      </button>

      <!-- Play/Pause button -->
      <button id="playBtn-melodies" class="wave-btn">
        <i class="fa fa-play"></i>
      </button>

      <!-- Next Track -->
      <button id="nextBtn-melodies" class="wave-btn">
        <i class="fa fa-forward"></i>
      </button>

      <!-- Download button -->
      <a id="downloadBtn-melodies" class="wave-btn" href="#" download>
        <i class="fa fa-download"></i>
      </a>
    </div>

    <!-- Track List -->
    <ul class="track-list" id="trackList-melodies"></ul>
  </section>

  <p class="legal-disclaimer">
    ⚠️ By downloading, you agree to our <a href="contract.html#licensing">Licensing</a>.
    Non‑commercial use under <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY‑NC 4.0</a>;
    commercial use requires a <a href="contract/Artist Producer Agr (Advance + royalty + pub).pdf" target="_blank">license</a>.
  </p>

  <!-- Login/Signup Modal -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="authTitle">Login</h2>
      
      <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button id="loginSubmit" class="btn-primary">Login</button>
        <p>Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
      </div>
      
      <div id="signupForm" style="display:none;">
        <input type="email" id="signupEmail" placeholder="Email" required>
        <input type="password" id="signupPassword" placeholder="Password (min 6 characters)" required>
        <input type="password" id="signupPasswordConfirm" placeholder="Confirm Password" required>
        <button id="signupSubmit" class="btn-primary">Sign Up</button>
        <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
      </div>
      
      <div id="userPanel" style="display:none;">
        <p>Logged in as: <strong id="userEmail"></strong></p>
        <button id="logoutBtn" class="btn-secondary">Logout</button>
      </div>
    </div>
  </div>

  <!-- Shopping Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Shopping Cart</h2>
      
      <div id="cartItems"></div>
      <div class="cart-total">
        <strong>Total: $<span id="cartTotal">0.00</span></strong>
      </div>
      
      <button id="checkoutBtn" class="btn-primary" disabled>Checkout</button>
      <p class="cart-note">You must be logged in to checkout</p>
    </div>
  </div>

  <!-- Donate Section -->
  <section id="donate">
    <h2>Support My Work</h2>
    <p>If you enjoy my work, consider making a donation:</p>

    <!-- PayPal -->
    <div class="center-donate-btn">
      <form action="https://www.paypal.biz/okmaso" method="post" target="_blank">
        <input type="hidden" name="hosted_button_id" value="YOUR_PAYPAL_BUTTON_ID">
        <button type="submit" class="wave-btn cash-btn paypal-btn">
          <i class="fa-brands fa-paypal"></i>
        </button>
      </form>
      <a href="https://cash.app/$duhmaso" target="_blank" style="display:inline-block;">
        <button class="wave-btn cash-btn">
          <i class="fa-brands fa-cc-visa"></i>
        </button>
      </a>
    </div>
    <p>Donate via Cash App</p>
  </section>

  <footer>
    <p>All music is original content released under the 
      <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">Creative Commons Attribution‑NonCommercial 4.0 License (CC BY‑NC 4.0)</a>.
      Commercial use requires a <a href="contract/Artist Producer Agr (Advance + royalty + pub).pdf" target="_blank">license</a>.
    </p>
    <p>&copy; 2025 SUBBASSES.</p>
  </footer>

  <!-- WaveSurfer.js library -->
  <script src="https://unpkg.com/wavesurfer.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // Firebase configuration (you'll need to replace with your own config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Make auth available globally
    window.firebaseAuth = auth;
    window.firebaseAuthMethods = {
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    };
  </script>

  <!-- Initialize WaveSurfer Playlists -->
  <script>
    window.onload = function() {
      // Define track arrays for each playlist with prices
      const beatsTracks = [
        { path: 'music/fysh 140.mp3', price: 29.99 },
        { path: 'music/level 120.mp3', price: 24.99 },
        { path: 'music/section 131.mp3', price: 29.99 },
        { path: 'music/thurs 140.mp3', price: 34.99 },
        { path: 'music/isn 140.mp3', price: 29.99 },
        { path: 'music/hav v2 140.mp3', price: 24.99 },
        { path: 'music/wash 140.mp3', price: 29.99 },
        { path: 'music/rp 145.mp3', price: 34.99 },
        { path: 'music/tiger 140.mp3', price: 29.99 }
      ];

      const melodiesTracks = [
        { path: 'music/autumn 140.mp3', price: 39.99 },
        { path: 'music/hiro_2 140.mp3', price: 44.99 },
        { path: 'music/index 157.mp3', price: 49.99 },
        { path: 'music/sunset 160.mp3', price: 39.99 },
        { path: 'music/rrainy 147.mp3', price: 44.99 },
        { path: 'music/plea 140.mp3', price: 39.99 },
        { path: 'music/cr88 140.mp3', price: 44.99 },
        { path: 'music/greek 120.mp3', price: 39.99 },
        { path: 'music/gex 140.mp3', price: 44.99 }
      ];

      // Create WaveSurfer instances
      const wavesurferBeats = WaveSurfer.create({
        container: '#waveform-beats',
        waveColor: 'violet',
        progressColor: 'purple',
        height: 100
      });

      const wavesurferMelodies = WaveSurfer.create({
        container: '#waveform-melodies',
        waveColor: '#4a9eff',
        progressColor: '#1e5a9e',
        height: 100
      });

      // Initialize playlists
      initPlaylist('beats', wavesurferBeats, beatsTracks);
      initPlaylist('melodies', wavesurferMelodies, melodiesTracks);

      function initPlaylist(playlistName, wavesurfer, tracks) {
        let currentTrack = 0;

        // Get elements
        const playBtn = document.getElementById(`playBtn-${playlistName}`);
        const nextBtn = document.getElementById(`nextBtn-${playlistName}`);
        const prevBtn = document.getElementById(`prevBtn-${playlistName}`);
        const downloadBtn = document.getElementById(`downloadBtn-${playlistName}`);
        const trackNameDiv = document.getElementById(`trackName-${playlistName}`);
        const trackListElement = document.getElementById(`trackList-${playlistName}`);

        // Populate track list
        tracks.forEach((track, index) => {
          const li = document.createElement('li');
          const trackInfo = document.createElement('div');
          trackInfo.className = 'track-info';
          
          const fileName = track.path.split('/').pop().replace('.mp3', '');
          const trackName = document.createElement('span');
          trackName.className = 'track-name';
          trackName.textContent = fileName;
          
          const trackPrice = document.createElement('span');
          trackPrice.className = 'track-price';
          trackPrice.textContent = `$${track.price.toFixed(2)}`;
          
          const addToCartBtn = document.createElement('button');
          addToCartBtn.className = 'add-to-cart-btn';
          addToCartBtn.innerHTML = '<i class="fa fa-cart-plus"></i> Add';
          addToCartBtn.onclick = (e) => {
            e.stopPropagation();
            addToCart(playlistName, track, fileName);
          };
          
          trackInfo.appendChild(trackName);
          trackInfo.appendChild(trackPrice);
          trackInfo.appendChild(addToCartBtn);
          
          li.appendChild(trackInfo);
          li.dataset.index = index;
          li.addEventListener('click', () => {
            currentTrack = index;
            loadTrack(track.path);
            updateActiveTrack();
          });
          trackListElement.appendChild(li);
        });

        // Load track and update UI
        function loadTrack(filePath) {
          wavesurfer.load(filePath);

          // Extract file name
          let fileName = filePath.split('/').pop().replace('.mp3', '');
          trackNameDiv.textContent = fileName;

          // Update download link
          downloadBtn.href = filePath;

          // Reset play button icon
          const icon = playBtn.querySelector('i');
          if (icon) {
            icon.classList.replace('fa-pause', 'fa-play');
          }
        }

        // Update active track in list
        function updateActiveTrack() {
          trackListElement.querySelectorAll('li').forEach((li, index) => {
            if (index === currentTrack) {
              li.classList.add('active');
            } else {
              li.classList.remove('active');
            }
          });
        }

        // Load first track
        loadTrack(tracks[currentTrack].path);
        updateActiveTrack();

        // Play/Pause button
        playBtn.addEventListener('click', () => {
          wavesurfer.playPause();
          const icon = playBtn.querySelector('i');
          if (wavesurfer.isPlaying()) {
            icon.classList.replace('fa-play', 'fa-pause');
          } else {
            icon.classList.replace('fa-pause', 'fa-play');
          }
        });

        // Next Track button
        nextBtn.addEventListener('click', () => {
          currentTrack = (currentTrack + 1) % tracks.length;
          loadTrack(tracks[currentTrack].path);
          updateActiveTrack();
        });

        // Previous Track button
        prevBtn.addEventListener('click', () => {
          currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
          loadTrack(tracks[currentTrack].path);
          updateActiveTrack();
        });

        // Auto-advance to next track when current finishes
        wavesurfer.on('finish', () => {
          currentTrack = (currentTrack + 1) % tracks.length;
          loadTrack(tracks[currentTrack].path);
          updateActiveTrack();
          wavesurfer.play();
        });
      }

      // Shopping Cart Management
      let cart = JSON.parse(localStorage.getItem('subbassesCart')) || [];
      let currentUser = null;

      function updateCartDisplay() {
        const cartCount = document.getElementById('cartCount');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        
        cartCount.textContent = cart.length;
        
        if (cart.length === 0) {
          cartItems.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
          cartTotal.textContent = '0.00';
          checkoutBtn.disabled = true;
        } else {
          let total = 0;
          cartItems.innerHTML = '';
          
          cart.forEach((item, index) => {
            total += item.price;
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
              <span class="cart-item-name">${item.name}</span>
              <span class="cart-item-category">${item.category}</span>
              <span class="cart-item-price">$${item.price.toFixed(2)}</span>
              <button class="remove-item" onclick="removeFromCart(${index})">
                <i class="fa fa-trash"></i>
              </button>
            `;
            cartItems.appendChild(cartItem);
          });
          
          cartTotal.textContent = total.toFixed(2);
          checkoutBtn.disabled = !currentUser;
        }
      }

      function addToCart(category, track, name) {
        const item = {
          category: category.charAt(0).toUpperCase() + category.slice(1),
          name: name,
          path: track.path,
          price: track.price
        };
        
        cart.push(item);
        localStorage.setItem('subbassesCart', JSON.stringify(cart));
        updateCartDisplay();
        
        // Show confirmation
        showNotification(`Added "${name}" to cart`);
      }

      window.removeFromCart = function(index) {
        cart.splice(index, 1);
        localStorage.setItem('subbassesCart', JSON.stringify(cart));
        updateCartDisplay();
      };

      function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, 2000);
      }

      // Modal Management
      const authModal = document.getElementById('authModal');
      const cartModal = document.getElementById('cartModal');
      const loginBtn = document.getElementById('loginBtn');
      const cartBtn = document.getElementById('cartBtn');
      const closeBtns = document.querySelectorAll('.close');

      loginBtn.addEventListener('click', () => {
        authModal.style.display = 'block';
      });

      cartBtn.addEventListener('click', () => {
        cartModal.style.display = 'block';
        updateCartDisplay();
      });

      closeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('.modal').style.display = 'none';
        });
      });

      window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
          e.target.style.display = 'none';
        }
      });

      // Auth Form Switching
      const showSignup = document.getElementById('showSignup');
      const showLogin = document.getElementById('showLogin');
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      const authTitle = document.getElementById('authTitle');

      showSignup.addEventListener('click', (e) => {
        e.preventDefault();
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
        authTitle.textContent = 'Sign Up';
      });

      showLogin.addEventListener('click', (e) => {
        e.preventDefault();
        signupForm.style.display = 'none';
        loginForm.style.display = 'block';
        authTitle.textContent = 'Login';
      });

      // Firebase Authentication
      const loginSubmit = document.getElementById('loginSubmit');
      const signupSubmit = document.getElementById('signupSubmit');
      const logoutBtn = document.getElementById('logoutBtn');

      // Auth state observer
      window.firebaseAuthMethods.onAuthStateChanged(window.firebaseAuth, (user) => {
        const userStatus = document.getElementById('userStatus');
        const userPanel = document.getElementById('userPanel');
        const userEmail = document.getElementById('userEmail');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const cartNote = document.querySelector('.cart-note');
        
        if (user) {
          currentUser = user;
          userStatus.textContent = 'Account';
          userEmail.textContent = user.email;
          
          loginForm.style.display = 'none';
          signupForm.style.display = 'none';
          userPanel.style.display = 'block';
          
          if (cart.length > 0) {
            checkoutBtn.disabled = false;
            cartNote.style.display = 'none';
          }
        } else {
          currentUser = null;
          userStatus.textContent = 'Login';
          
          userPanel.style.display = 'none';
          loginForm.style.display = 'block';
          
          checkoutBtn.disabled = true;
          cartNote.style.display = 'block';
        }
        
        updateCartDisplay();
      });

      // Login
      loginSubmit.addEventListener('click', async () => {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
          await window.firebaseAuthMethods.signInWithEmailAndPassword(window.firebaseAuth, email, password);
          authModal.style.display = 'none';
          showNotification('Logged in successfully!');
        } catch (error) {
          showNotification('Login failed: ' + error.message);
        }
      });

      // Sign Up
      signupSubmit.addEventListener('click', async () => {
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupPasswordConfirm').value;
        
        if (password !== confirmPassword) {
          showNotification('Passwords do not match!');
          return;
        }
        
        if (password.length < 6) {
          showNotification('Password must be at least 6 characters!');
          return;
        }
        
        try {
          await window.firebaseAuthMethods.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
          authModal.style.display = 'none';
          showNotification('Account created successfully!');
        } catch (error) {
          showNotification('Sign up failed: ' + error.message);
        }
      });

      // Logout
      logoutBtn.addEventListener('click', async () => {
        try {
          await window.firebaseAuthMethods.signOut(window.firebaseAuth);
          authModal.style.display = 'none';
          showNotification('Logged out successfully!');
        } catch (error) {
          showNotification('Logout failed: ' + error.message);
        }
      });

      // Checkout
      document.getElementById('checkoutBtn').addEventListener('click', () => {
        if (!currentUser) {
          showNotification('Please login to checkout');
          return;
        }
        
        // Here you would integrate with a payment processor like Stripe
        showNotification('Checkout feature coming soon! Total: $' + document.getElementById('cartTotal').textContent);
        
        // For demo purposes, clear cart after "checkout"
        // In production, only clear after successful payment
        // cart = [];
        // localStorage.setItem('subbassesCart', JSON.stringify(cart));
        // updateCartDisplay();
        // cartModal.style.display = 'none';
      });

      // Initialize cart display
      updateCartDisplay();
    };
  </script>
</body>
</html>
